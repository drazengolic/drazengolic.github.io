<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>API on Дражен Голић</title>
    <link>https://www.drazengolic.com/sr/tags/api/</link>
    <description>Recent content in API on Дражен Голић</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>sr-BA</language>
    <copyright>&amp;copy; Drazen Golic ([CC BY 4.0](https://creativecommons.org/licenses/by/4.0/deed.en))</copyright>
    <lastBuildDate>Tue, 28 Nov 2023 11:30:23 +0200</lastBuildDate><atom:link href="https://www.drazengolic.com/sr/tags/api/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Заштита API сервиса за мобилне апликације без регистрације корисника</title>
      <link>https://www.drazengolic.com/sr/blog/secure-mobile-api/</link>
      <pubDate>Tue, 28 Nov 2023 11:30:23 +0200</pubDate>
      
      <guid>https://www.drazengolic.com/sr/blog/secure-mobile-api/</guid>
      <description>Проблем Претпоставимо да је потребно креирати API сервис за мобилну апликацију, при чему апликација мора да буде потпуно функционална без тражења од корисника да се (првобитно) региструју. Разлога може да буде више, на примјер:
Апликација само преузима неки садржај, и нема очигледне користи од регистрације ни за нас ни за кориснике Многе потенцијалне кориснике може да одбије захтјев за регистрацијом Креирање логовања преко социјалних мрежа или регистрације са имејлом и шифром је напорно Брину нас стриктни GDPR прописи и радије не би да имамо приступ приватним подацима ако за њима нема потребе Али, и даље желимо да наши API сервиси буду екслузивни за нашу апликацију, како би спријечили злоупотребу података, али и ресурса за које плаћамо.
</description>
      <content:encoded><![CDATA[<h2 id="проблем">Проблем</h2>
<p>Претпоставимо да је потребно креирати API сервис за мобилну апликацију, при чему апликација мора да буде потпуно функционална без тражења од корисника да се (првобитно) региструју. Разлога може да буде више, на примјер:</p>
<ul>
<li>Апликација само преузима неки садржај, и нема очигледне користи од регистрације ни за нас ни за кориснике</li>
<li>Многе потенцијалне кориснике може да одбије захтјев за регистрацијом</li>
<li>Креирање логовања преко социјалних мрежа или регистрације са имејлом и шифром је напорно</li>
<li>Брину нас стриктни GDPR прописи и радије не би да имамо приступ приватним подацима ако за њима нема потребе</li>
</ul>
<p>Али, и даље желимо да наши API сервиси буду екслузивни за нашу апликацију, како би спријечили злоупотребу података, али и ресурса за које плаћамо.</p>
<p>Може се наићи на неколико опција, али су све проблематичне:</p>
<ol>
<li><em>Потпуно отворен API</em> - За ово смо се већ изјаснили да није опција</li>
<li><em>Кориштење тајног кључа, дијељеног између апликације и сервера</em> - Ово је лако провалити, јер се апликације релативно лако декомпајлирају, а текстуалне константе извлаче без проблема. У случају да се кључ открије, потребно је ажурирати и апликацију и сервер, и функционисаће све док се и нови кључ не открије на потпуно исти начин</li>
<li><em>Спремање дијелова кључа на различита мјеста у коду, или кориштење релативно једноставног алгоритма за његово генерисање</em> - Ово није знатно теже за провалити од претходног случаја, тако да подједнако није вриједно труда</li>
</ol>
<p>Међутим, све и да тражимо од корисника да се региструју, неко ко је довољно способан да открије свој легитимно добијени приступни кључ према API сервисима, и даље може да их злоупотријеби уколико не постоји механизам <strong>за ограничавање њиховог кориштења</strong>, попут ограничавања и пригушивања броја захтјева. Можемо поставити ограничења на бази ИП адреса (и то је <strong>увијек</strong> потребно!), али то ограничење се лако заобиђе кориштењем различитих прокси сервера, или са могућношћу приступа већем броју уређаја са конекцијом на интернет и са различитим ИП адресама.</p>
<h2 id="рјешење">Рјешење</h2>
<p>Дакле, и даље нам је потребан <em>некакав</em> вид регистрације. Али, умјесто корисника, можемо да <strong>региструјемо уређај</strong>. Међутим, како ћемо да знамо да је управо <em>наша апликација</em> та која жели да се региструје, а не неко или нешто друго? Тако што ћемо да искористимо нешто што је јединствено за нашу апликацију, а то су <strong>пуш нотификације</strong>.</p>
<blockquote>
<p><strong>Одрицање од одговорности</strong>: не постоје рјешења која су непробојна, а самим тим ни ово није једно од њих. Међутим, довољно је добро да држи подаље оне који су мање технички спретни или мање мотивисани, а уједно и омогућује примјену сигурносних стратегија сличних онима гдје постоје регистровани корисници.</p></blockquote>
<p>Без даљег дужења, слиједи потпуни <a href="https://en.wikipedia.org/wiki/Sequence_diagram">дијаграм секвенци</a> процеса регистрације уређаја:</p>
<figure><img src="/images/mobile_secure_sr.png"
    alt="Процес регистрације уређаја"><figcaption>
      <p>Процес регистрације уређаја</p>
    </figcaption>
</figure>

<p><em>Укратко речено: апликација тражи од сервера да јој пошаље УРЛ за регистрацију преко податковне пуш поруке, који је уједно енкриптован јавним кључем који је генерисала апликација.</em></p>
<p>Након што је регистрација завршена, наредне аутентикације уређаја на API могу да се обављају стандардним <strong>освјежавањем токена</strong>.</p>
<p>Важне напомене у вези изазова за регистрацију:</p>
<ul>
<li>Рок да се испуни неки изазов треба да буде релативно кратак, не дужи од пар минута</li>
<li>Серверске руте за захтјевање и испуњавање изазова су јавне, и приступ њима треба да буде што боље ограничен</li>
<li>Потребно је имплементирати некакав процес у позадини који ће да брише све изазове из базе чији је рок истекао (или постављањем TTL вриједности ако се користи нпр. Redis)</li>
</ul>
<p>Генерисани ЈИБ уређаја може да буде UUID или нешто слично. А ако је достављање пуш нотификација саставни дио апликације, онда би било добро негдје сачувати ЈИБ заједно са регистрационим токеном пуш сервиса (и тако ефективно направити налог за уређај), како би се регистрациони токен лако ажурирао на серверу након што мобилна апликација добије нови токен од пуш сервиса. Важно је напоменути да <strong>није потребно</strong> одобрење од корисника апликације за добијање податковних порука уколико оне не садрже нотификације.</p>
<p>Чувајући ЈИБ уређаја унутар приступног токена и токена за освјежавање нам омогућава да ограничимо кориштење сервиса по уређају, а у случају да је детектовано сумњиво понашање, могуће је и одбити захтјев за освјежењем приступног токена и тако привремено или трајно угасити налог. Зато је потребно да рок трајања приступног токена буде разумно кратак.</p>
<h2 id="употреба-у-стварном-свијету">Употреба у Стварном Свијету™</h2>
<p>Иако имам пројекат који је тзв. доказ концепта овог дизајна, он није још увијек спреман за продукцију. Међутим, ако се некоме свидјела идеја и жели да је примијени у својој апликацији, волио бих да сазнам колико добро је прошла, и о том ме можете обавијестити преко било ког канала на којем сам присутан. Можда немам коментаре на овом сајту, али радо ћу објавити искуства из ”стварног свијета” у оквиру овог чланка, наравно уз одобрење.</p>
]]></content:encoded>
    </item>
    
  </channel>
</rss>